import { NextResponse } from 'next/server'; import { getClient } from '@/lib/db'; export async function POST(){ const prisma=await getClient(); const mins=Number(process.env.PRESENCE_STALE_MIN||10); const cutoff=new Date(Date.now()-mins*60*1000); const stale=await (prisma as any).helperPresence.updateMany({ where:{ updatedAt:{ lt:cutoff }, NOT:{ status:'OFFLINE' } }, data:{ status:'OFFLINE' } }); return NextResponse.json({ok:true,markedOffline:stale.count,cutoff:cutoff.toISOString()}); }
